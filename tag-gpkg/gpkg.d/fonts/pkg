# vim: ft=sh :

FONT_DIRECTORY=$HOME/.local/share/fonts

NERD_FONT_VERSION="v3.4.0"
NERD_FONT_NAMES="Hack FiraCode NerdFontsSymbolsOnly"
NERD_FONT_BASE_URL="https://github.com/ryanoasis/nerd-fonts/releases/download/$NERD_FONT_VERSION/"

EMOJI_FONT_URL="https://github.com/googlefonts/noto-emoji/raw/main/fonts/NotoColorEmoji.ttf"

__nerd_font_install() {
	local font file url
	font=$1
	file="$font.tar.xz"
	url="$NERD_FONT_BASE_URL/$file"
	_gpkg_fetch "$url" | tar --wildcards -Jxf - "*.ttf" ||
		_gpkg_log_eror "Failed to download font $font"
}

_gpkg_version() {
	echo "$NERD_FONT_VERSION"
}

_gpkg_install() {
	if [ -d "$FONT_DIRECTORY" ]; then
		_gpkg_log_info "Nothing to do as $FONT_DIRECTORY folder already exists"
		exit 0
	fi

	mkdir -p "$FONT_DIRECTORY"
	cd "$FONT_DIRECTORY" || return

	_gpkg_log_info "Downloading emoji font"
	curl -SsL "$EMOJI_FONT_URL" > "${EMOJI_FONT_URL##*/}"

	for font in $NERD_FONT_NAMES; do
		_gpkg_log_info "Downloading nerd font $font"
		__nerd_font_install "$font"
	done

	_gpkg_log_info "Generating font cache for X11..."
	mkfontscale
	mkfontdir
	xset +fp "$FONT_DIRECTORY"

	_gpkg_log_info "Regenerating fontconfig cache..."
	fc-cache -f
}

_gpkg_uninstall() {
	_gpkg_log_info "Removing $FONT_DIRECTORY"
	rm -rf "$FONT_DIRECTORY"
}
