# vim: ft=sh :

FONT_DIRECTORY=$HOME/.local/share/fonts

FONT_VERSION="v2.2.2"
FONT_ZIP_FILE="RobotoMono.zip"
FONTS_URL="https://github.com/ryanoasis/nerd-fonts/releases/download/$FONT_VERSION/$FONT_ZIP_FILE"

EMOJI_FONT_VERSION=14.0.2
EMOJI_FONT_NAME="TwitterColorEmoji-SVGinOT-Linux-$EMOJI_FONT_VERSION.tar.gz"
EMOJI_FONT_BASE_URL="https://github.com/eosrei/twemoji-color-font/releases/download/v$EMOJI_FONT_VERSION"
EMOJI_FONT_URL="$EMOJI_FONT_BASE_URL/$EMOJI_FONT_NAME"
EMOJI_FONT_NAME="TwitterColorEmoji-SVGinOT.ttf"
EMOJI_FONT_PATH="TwitterColorEmoji-SVGinOT-Linux-$EMOJI_FONT_VERSION/TwitterColorEmoji-SVGinOT.ttf"

_gpkg_install() {
	if [ -d "$FONT_DIRECTORY" ]; then
		_gpkg_log_info "Nothing to do as $FONT_DIRECTORY folder already exists"
		exit 0
	fi

	mkdir -p "$FONT_DIRECTORY"
	cd "$FONT_DIRECTORY" || return

	_gpkg_log_info "Downloading emoji font"
	curl -SsL "$EMOJI_FONT_URL" | tar xvzO "$EMOJI_FONT_PATH" > "$FONT_DIRECTORY/$EMOJI_FONT_NAME"

	_gpkg_log_info "Downloading fonts"
	mkdir -p tmpfonts
	cd tmpfonts || _gpkg_log_eror "Failed to create font directory"
	wget "$FONTS_URL" || _gpkg_log_eror "Failed to create font directory"
	unzip "$FONT_ZIP_FILE" || _gpkg_log_eror "Failed to unzip font file"
	cd .. && find tmpfonts -name '*Windows*' -delete
	mv tmpfonts/*\.*tf .
	rm -rf tmpfonts "$FONT_ZIP_FILE"

	_gpkg_log_info "Generating fontscale..."
	mkfontscale

	_gpkg_log_info "Generating fontdir..."
	mkfontdir

	_gpkg_log_info "Loading font folder to X..."
	xset +fp "$FONT_DIRECTORY"
}

_gpkg_uninstall() {
	_gpkg_log_info "Removing $FONT_DIRECTORY"
	rm -rf "$FONT_DIRECTORY"
}
